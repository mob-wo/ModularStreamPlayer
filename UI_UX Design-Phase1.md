## **UI/UX設計書: Modular Stream Player (v1.0)**

### 1. 全体コンセプト

*   **デザイン**: マテリアルデザイン3 (Material You) に準拠し、クリーンで直感的な操作性を提供する。
*   **ナビゲーション**: 基本は単一Activity構成とし、Jetpack Compose Navigationを用いて画面遷移を管理する。

### 2. 画面遷移図 (Screen Flow)

ユーザーの基本的な操作の流れを図示します。

```mermaid
graph TD
    A[アプリアイコンをタップ] --> B{ストレージ権限は？};
    B -- 許可済み --> C[ファイルブラウザ画面];
    B -- 未許可 --> D[権限要求ダイアログ];
    D --> |許可| C;
    D --> |拒否| E[権限が必要な旨を説明する画面];

    C -- 曲アイテムをタップ --> F[再生画面];
    F -- バックキー/上部矢印 --> C;

    C -- フォルダアイテムをタップ --> C;

    subgraph "全画面で表示"
        G[通知領域のコントローラー]
    end
    F -- バックグラウンドへ --> G;
    C -- バックグラウンドへ (再生中) --> G;
    G -- 通知をタップ --> F;

    subgraph "フェーズ2以降"
        C -- 2画面モード切替アイコン --> H[ファイルブラウザ画面 (2画面モード)];
        H -- 曲アイテムをタップ --> H;
    end

```

### 3. ワイヤーフレーム (Wireframes)

各画面のレイアウトと主要コンポーネントを定義します。

---

#### **3.1. ファイルブラウザ画面 (BrowserScreen)**

**目的**: ユーザーがストレージ内の音楽ファイルやフォルダを閲覧し、再生したい曲を選択する。

**[ワイヤーフレーム]**
```
+------------------------------------------------------+
| [≡] Modular Stream Player      [🖥️][🔲][⚙️]          |  <-- トップバー (TopAppBar)
+------------------------------------------------------+
| /storage/emulated/0/Music/                         |  <-- 現在のパス表示 (Breadcrumbs)
+------------------------------------------------------+
|                                                      |
|  [📁] .. (親フォルダへ)                              |  <-- リストアイテム (フォルダ)
|  --------------------------------------------------  |
|  [📁] Rock                                           |
|  --------------------------------------------------  |
|  [🎵] great_song.mp3                                 |  <-- リストアイテム (ファイル)
|      (ファイル名)                                    |
|  --------------------------------------------------  |
|  [🖼️] Another Brick in the Wall                     |  <-- (フェーズ2) ID3タグ表示
|      Pink Floyd                                      |
|  --------------------------------------------------  |
|                                                      |
|                                                      |
|                                                      |
+------------------------------------------------------+
| (フェーズ2: 2画面モード時)                             |
| +--------------------------------------------------+ |
| | [🖼️] 曲名                    [▶️] [⏭️]              | |  <-- ミニプレーヤー
| +--------------------------------------------------+ |
+------------------------------------------------------+
```

**コンポーネント詳細:**

*   **トップバー (TopAppBar)**:
    *   `[≡]` (ナビゲーションドロワーアイコン): (将来拡張用)
    *   **アプリ名/画面名**: "Modular Stream Player"
    *   `[🖥️]` (画面モード切替アイコン): フェーズ2で実装。1画面/2画面モードを切り替える。
    *   `[🔲]` (表示密度切替アイコン): フェーズ2で実装。大/中/小のリスト表示を切り替える。
    *   `[⚙️]` (設定アイコン): NAS接続設定画面などへ遷移する。

*   **現在のパス表示 (Breadcrumbs)**:
    *   現在表示しているフォルダのパスを示す。タップで上位階層へジャンプできる（将来拡張）。

*   **リストアイテム (LazyColumn / LazyGrid)**:
    *   **フェーズ1**: アイコン＋ファイル名/フォルダ名を表示するシンプルなリスト。
    *   **フェーズ2**: ID3タグ情報をリッチに表示。表示密度切替に対応する。
        *   **大 (リスト)**: 上記ワイヤーフレームの通り。
        *   **中 (2列グリッド)**: 正方形のアートワークの下に曲名を1行表示。
        *   **小 (3列グリッド)**: 正方形のアートワークのみを表示。
    *   **操作**:
        *   フォルダアイテムをタップ: そのフォルダに移動。
        *   ファイルアイテムをタップ: 再生画面に遷移（1画面モード時） or ミニプレーヤーで再生開始（2画面モード時）。

*   **ミニプレーヤー (MiniPlayer)**:
    *   フェーズ2で実装。2画面モード時に画面下部に表示される。
    *   現在再生中の曲のアートワーク、曲名、再生/一時停止、次の曲へボタンを表示。
    *   このエリアをタップすると、全画面の再生画面に遷移する。

---

#### **3.2. 再生画面 (PlayerScreen)**

**目的**: 現在再生中の曲に関する詳細情報を表示し、再生コントロール機能を提供する。

**[ワイヤーフレーム]**
```
+------------------------------------------------------+
| [↓]                                   [⠇]           |  <-- トップバー
+------------------------------------------------------+
|                                                      |
|                                                      |
|           +--------------------------+               |
|           |                          |               |
|           |      アルバムアート       |               |  <-- 曲のアートワーク (AsyncImage)
|           |                          |               |
|           |                          |               |
|           +--------------------------+               |
|                                                      |
|                                                      |
|             Another Brick in the Wall                |  <-- 曲名 (Text)
|                   Pink Floyd                         |  <-- アーティスト名 (Text)
|                                                      |
+------------------------------------------------------+
| 01:23  /--●------------------------/  03:55          |  <-- シークバー (Slider) + 時間表示
+------------------------------------------------------+
|                                                      |
|       [🔀]     [⏮️]     [▶️]     [⏭️]     [🔁]        |  <-- 再生コントロール
|                                                      |
+------------------------------------------------------+
```

**コンポーネント詳細:**

*   **トップバー**:
    *   `[↓]` (閉じるアイコン): タップするとファイルブラウザ画面に戻る。
    *   `[⠇]` (その他メニュー): プレイリストに追加、詳細情報などの将来拡張用。

*   **アルバムアート**:
    *   画面の大部分を占める。`Coil`を使って非同期で読み込む。アートワークがない場合はデフォルト画像を表示。

*   **曲名・アーティスト名**:
    *   ID3タグから取得した情報を表示。

*   **シークバー (Slider)**:
    *   曲の現在の再生位置と総時間を表示。
    *   ユーザーがドラッグして再生位置を変更できる。

*   **再生コントロール (Player Controls)**:
    *   `[🔀]` (シャッフル): (フェーズ4)
    *   `[⏮️]` (前の曲へ): (フェーズ4)
    *   `[▶️]` / `[⏸️]` (再生/一時停止): フェーズ1で実装。再生状態に応じてアイコンが切り替わる。
    *   `[⏭️]` (次の曲へ): (フェーズ4)
    *   `[🔁]` (リピート): (フェーズ4)

---

### 4. 通知領域のコントローラー

**目的**: アプリがバックグラウンドにある場合でも、ユーザーが音楽をコントロールできるようにする。

**[ワイヤーフレーム]**
```
+------------------------------------------------------+
| [🖼️]  **Another Brick in the Wall**    [⏮️] [⏸️] [⏭️] [X] |
|       Pink Floyd                                     |
+------------------------------------------------------+
```

**コンポーネント詳細:**
*   `Jetpack Media3` の `MediaSession` と `MediaNotification.Provider` を使うことで、このUIは比較的容易に実装可能。
*   **[🖼️]**: アルバムアート
*   **曲名・アーティスト名**
*   **コントロール**: 前の曲へ、再生/一時停止、次の曲へ
*   **[X]**: 通知を消去し、再生サービスを停止する。

---
